<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cypher AST Generator for Python &mdash; PyCypher: Cypher parser for Python  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Cypher AST Generator for Python" href="usage.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="#" class="icon icon-home">
            PyCypher: Cypher parser for Python
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Cypher AST Generator for Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">PyCypher: Cypher parser for Python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Cypher AST Generator for Python</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p><a class="reference external" href="https://github.com/zacernst/pycypher/actions/workflows/makefile.yml"><img alt="Install and run tests" src="https://github.com/zacernst/pycypher/actions/workflows/makefile.yml/badge.svg" /></a></p>
<p><a class="reference external" href="https://github.com/zacernst/pycypher/actions/workflows/docs.yml"><img alt="Build Sphinx documentation" src="https://github.com/zacernst/pycypher/actions/workflows/docs.yml/badge.svg" /></a></p>
<section id="cypher-ast-generator-for-python">
<h1>Cypher AST Generator for Python<a class="headerlink" href="#cypher-ast-generator-for-python" title="Link to this heading"></a></h1>
<p>This is a <em>work in progress</em>, by which I mean, “ugly, but fixable.” It
is also woefully incomplete. It generates an abstract syntax tree for
Cypher statements that use only a subset of the language. That subset is
growing, but it’s still small.</p>
<p>Additionally, this package contains the beginning of a query engine that
is designed to accept Cypher queries and return results from arbitrary
graph structures in Python. This functionality is in a <em>very</em> early
state, and works only for trivial queries.</p>
<p>The hope is that this will be useful for building modules that can take
advantage of the Cypher query language, by eliminating the need to do
all the boring work of writing a parser and generating an AST.</p>
<section id="how-to-use-it">
<h2>How to use it<a class="headerlink" href="#how-to-use-it" title="Link to this heading"></a></h2>
<p>Don’t. But if you really want to, then:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pycypher.parser</span> <span class="kn">import</span> <span class="n">CypherParser</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cypher</span> <span class="o">=</span> <span class="n">CypherParser</span><span class="p">(</span><span class="s2">&quot;MATCH (n:Thing) RETURN n.foo&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cypher</span><span class="o">.</span><span class="n">parsed</span><span class="o">.</span><span class="n">print_tree</span><span class="p">()</span>

<span class="go">Cypher</span>
<span class="go">└── Query</span>
<span class="go">    ├── Match</span>
<span class="go">    │   └── Node</span>
<span class="go">    │       └── NodeNameLabel</span>
<span class="go">    │           ├── n</span>
<span class="go">    │           └── Thing</span>
<span class="go">    └── Return</span>
<span class="go">        └── Projection</span>
<span class="go">            └── ObjectAttributeLookup</span>
<span class="go">                ├── n</span>
<span class="go">                └── foo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cypher</span><span class="o">.</span><span class="n">parsed</span><span class="p">)</span>
<span class="go">Cypher(Query(Match(Node(NodeNameLabel(n, Thing), None)), Return(Projection([ObjectAttributeLookup(n, foo)]))))</span>
</pre></div>
</div>
<p>If you want to understand what’s happening, what Python classes are
being built, etc., then you’ll have to use the source, Luke. Check out
the <code class="docutils literal notranslate"><span class="pre">__main__</span></code> function at the end of the <code class="docutils literal notranslate"><span class="pre">cypher.py</span></code> script. There
are no docs yet. Like I said, this is a <em>work in progress</em>.</p>
<p>In addition to parsing Cypher queries, there is the beginning of support
for querying your data with Cypher. It is very experimental.</p>
<p>The design of <code class="docutils literal notranslate"><span class="pre">pycypher</span></code>’s querying process requires a few simple
steps:</p>
<ul class="simple">
<li><p>First, you define individual <code class="docutils literal notranslate"><span class="pre">Fact</span></code> objects from your graph data;</p></li>
<li><p>then you put them all in a <code class="docutils literal notranslate"><span class="pre">FactCollection</span></code> object.</p></li>
<li><p>Instantiate a <code class="docutils literal notranslate"><span class="pre">CypherParser</span></code> object with your Cypher query;</p></li>
<li><p>finally, call <code class="docutils literal notranslate"><span class="pre">CypherParser.solutions</span></code> with your <code class="docutils literal notranslate"><span class="pre">FactCollection</span></code>,
which will return a list of dictionaries containing solutions to your
query.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">################################</span>
<span class="c1">### Build FactCollection</span>
<span class="c1">################################</span>

<span class="n">fact1</span> <span class="o">=</span> <span class="n">FactNodeHasLabel</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;Thing&quot;</span><span class="p">)</span>
<span class="n">fact2</span> <span class="o">=</span> <span class="n">FactNodeHasAttributeWithValue</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="n">Literal</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">))</span>
<span class="n">fact3</span> <span class="o">=</span> <span class="n">FactNodeRelatedToNode</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;MyRelationship&quot;</span><span class="p">)</span>
<span class="n">fact4</span> <span class="o">=</span> <span class="n">FactNodeHasLabel</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;OtherThing&quot;</span><span class="p">)</span>
<span class="n">fact5</span> <span class="o">=</span> <span class="n">FactNodeHasAttributeWithValue</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="n">Literal</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

<span class="n">fact_collection</span> <span class="o">=</span> <span class="n">FactCollection</span><span class="p">([</span><span class="n">fact1</span><span class="p">,</span> <span class="n">fact2</span><span class="p">,</span> <span class="n">fact3</span><span class="p">,</span> <span class="n">fact4</span><span class="p">,</span> <span class="n">fact5</span><span class="p">])</span>

<span class="c1">###########################################</span>
<span class="c1">### Define Cypher Query</span>
<span class="c1">###########################################</span>

<span class="n">cypher_statement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;MATCH (n:Thing </span><span class="si">{key: 2}</span><span class="s2">) RETURN n.key&quot;&quot;&quot;</span>

<span class="c1">###########################################</span>
<span class="c1">### Parse Cypher Query</span>
<span class="c1">###########################################</span>

<span class="n">parsed</span> <span class="o">=</span> <span class="n">CypherParser</span><span class="p">(</span><span class="n">cypher_statement</span><span class="p">)</span>
<span class="n">instances</span> <span class="o">=</span> <span class="n">parsed</span><span class="o">.</span><span class="n">solutions</span><span class="p">(</span><span class="n">fact_collection</span><span class="p">)</span>
<span class="n">rich</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="n">instances</span><span class="p">)</span>
</pre></div>
</div>
<p>which will return:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span><span class="n">n</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">n</span></code> is the node variable from your Cypher query. It says that
the node whose ID is <code class="docutils literal notranslate"><span class="pre">1</span></code> can be put in for the value of <code class="docutils literal notranslate"><span class="pre">n</span></code> in your
Cypher query. Alert readers will notice that the query actually asks for
an attribute of <code class="docutils literal notranslate"><span class="pre">n</span></code>, not the ID of <code class="docutils literal notranslate"><span class="pre">n</span></code> itself. I know; we haven’t
gotten there yet.</p>
<p>Why is it designed this way? The idea is that if you’ve got a graph-like
structure (say, a <code class="docutils literal notranslate"><span class="pre">networkx</span></code> graph), it would be very easy to walk the
graph and create a list of simple <code class="docutils literal notranslate"><span class="pre">Fact</span></code> objects. Those can be put in
a <code class="docutils literal notranslate"><span class="pre">FactCollection</span></code> and passed into your <code class="docutils literal notranslate"><span class="pre">CypherParser</span></code>. In other
words, the various <code class="docutils literal notranslate"><span class="pre">Fact</span></code> classes are there to provide a simple and
intuitive target to represent graph data. So long as you can get the
data into a <code class="docutils literal notranslate"><span class="pre">FactCollection</span></code>, you can query it. The next logical step
in developing this package is to provide out-of-the-box methods for
querying various graph data formats, probably starting with
<code class="docutils literal notranslate"><span class="pre">networkx</span></code>.</p>
</section>
<section id="under-the-hood">
<h2>Under the hood<a class="headerlink" href="#under-the-hood" title="Link to this heading"></a></h2>
<p>The package is simple, but complicated in the sense of “God, this is
tedious!”. It contains a grammar in the old style of Lex and Yacc, which
is processed by the <code class="docutils literal notranslate"><span class="pre">PLY</span></code> package. From there, an AST is generated
which is constructed from a set of classes representing the semantic
structure of the query (in contrast to a so-called “concrete” syntax
tree which literally represents only the exact syntax).</p>
<p>For querying your data with the help of the AST, this package treats
querying as a problem of constraint satisfaction over a finite domain.
The AST yields a set of constraints such as “There is a node named <code class="docutils literal notranslate"><span class="pre">n</span></code>
which has the label <code class="docutils literal notranslate"><span class="pre">Foo</span></code>”. The <code class="docutils literal notranslate"><span class="pre">FactCollection</span></code> object defines the
domain of the constraint satisfaction problem. When you ask for
solutions, a potentially large number of partial functions over the
finite domain is generated, which form the constraints. Then we apply a
backtracking constraint solver to get every set of assignments of
variables to the domain satisfying the constraints.</p>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading"></a></h2>
<section id="mac-and-linux">
<h3>Mac and Linux<a class="headerlink" href="#mac-and-linux" title="Link to this heading"></a></h3>
<p>You’ll need to be able to run <code class="docutils literal notranslate"><span class="pre">uv</span></code> in order to use the <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>.
To install <code class="docutils literal notranslate"><span class="pre">uv</span></code> on Linux or Mac:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-LsSf<span class="w"> </span>https://astral.sh/uv/install.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh
</pre></div>
</div>
<p>If you don’t have <code class="docutils literal notranslate"><span class="pre">make</span></code> on your Mac, then you should:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>brew<span class="w"> </span>install<span class="w"> </span>make
</pre></div>
</div>
<p>And if you don’t have <code class="docutils literal notranslate"><span class="pre">brew</span></code>, then install it with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/bin/bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh<span class="k">)</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>If you’re running Linux without <code class="docutils literal notranslate"><span class="pre">make</span></code>, then follow the directions for
your distribution. For example, on Ubuntu, you can:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>make
</pre></div>
</div>
</section>
<section id="windows">
<h3>Windows<a class="headerlink" href="#windows" title="Link to this heading"></a></h3>
<p>On Windows, erase your hard drive, install Linux, and then follow the
directions above.</p>
</section>
</section>
<section id="setting-everything-up">
<h2>Setting everything up<a class="headerlink" href="#setting-everything-up" title="Link to this heading"></a></h2>
<p>To set up the virtual environment, install all the dependencies, install
the right version of Python, build the package, install it as an
editable project, run a bunch of unit tests, and build HTML
documentation, do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>all
</pre></div>
</div>
<p>To clean everything up, deleting the virtual environment, documentation,
and so on, do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>clean
</pre></div>
</div>
<p>You don’t <em>need</em> to use the <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>, and therefore you don’t <em>need</em>
to have <code class="docutils literal notranslate"><span class="pre">uv</span></code> installed on your system. But that’s what all the cool
kids are using these days.</p>
</section>
</section>
<section id="pycypher-a-pythonic-cypher-query-builder">
<h1>PyCypher: A Pythonic Cypher Query Builder<a class="headerlink" href="#pycypher-a-pythonic-cypher-query-builder" title="Link to this heading"></a></h1>
<p><strong>PyCypher</strong> is a Python library for parsing and executing Cypher queries.</p>
<p>Check out the <a class="reference internal" href="usage.html"><span class="doc">Cypher AST Generator for Python</span></a> section for further information, including
how to <a class="reference internal" href="usage.html#installation"><span class="std std-ref">Cypher AST Generator for Python</span></a> the project.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This project is under active development.</p>
</div>
<section id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Link to this heading"></a></h2>
<div class="toctree-wrapper compound">
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Cypher AST Generator for Python</a><ul>
<li class="toctree-l2"><a class="reference internal" href="usage.html#how-to-use-it">How to use it</a></li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#id1">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="usage.html#mac-and-linux">Mac and Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="usage.html#windows">Windows</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#setting-everything-up">Setting everything up</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="generated/pycypher.html">pycypher</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/pycypher.cypher_lexer.html">pycypher.cypher_lexer</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/pycypher.exceptions.html">pycypher.exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/pycypher.fact.html">pycypher.fact</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/pycypher.fact.html#facts">Facts</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="generated/pycypher.logger.html">pycypher.logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/pycypher.node_classes.html">pycypher.node_classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/pycypher.node_classes.html#node-classes">Node Classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="generated/pycypher.solver.html">pycypher.solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/pycypher.tree_mixin.html">pycypher.tree_mixin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/pycypher.tree_mixin.html#treemixin">TreeMixin</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="usage.html" class="btn btn-neutral float-right" title="Cypher AST Generator for Python" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Zachary Ernst.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>